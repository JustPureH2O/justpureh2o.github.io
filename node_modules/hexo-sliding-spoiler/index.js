const fs = require('hexo-fs');
const path = require('path');

hexo.extend.tag.register('collapsible', (args, content) =>
`<div class='collapsible collapsed'>
    <div class='collapsible-title'>
        ${args.join("\t")}
    </div>
    <div class='collapsible-content'>
	<p></p>
        ${
            hexo.render.renderSync({
                text: content,
                engine: "markdown"
            }) || "No content to show"
        }
	<p></p>	
    </div>
</div>`, {
    ends: true
});

hexo.extend.generator.register('spoiler_asset', () => [
    {
        path: 'css/collapsible.css',
        data: function () {
            return fs.createReadStream(path.resolve(path.resolve(__dirname, "./assets"), 'collapsible.css'));
        }
    },
    {
        path: 'js/collapsible.js',
        data: function () {
            return fs.createReadStream(path.resolve(path.resolve(__dirname, "./assets"), 'collapsible.js'));
        }
    }
]);

hexo.extend.filter.register('after_post_render', (data) => {
    let link_css = `<link rel="stylesheet" href="${hexo.config.root}css/collapsible.css" type="text/css">`;
    let link_js = `<script src="${hexo.config.root}js/collapsible.js" type="text/javascript" async></script>`;
    data.content += link_css + link_js;
    return data;
});
